(function(d,m){typeof exports=="object"&&typeof module!="undefined"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(d=typeof globalThis!="undefined"?globalThis:d||self,m(d.SimpleScene={}))})(this,function(d){"use strict";function m(e,r,t,n={}){console.log("Adding listener",{element:e,eventName:r,handler:t});const i=n.listener||void 0;return e.addEventListener(r,t,i),typeof n.runImmediately!="boolean"&&(n.runImmediately=!0),n.runImmediately&&t(),function(){console.log("Removing listener",{element:e,eventName:r,handler:t}),e.removeEventListener(r,t)}}function I(e,r=void 0,t=void 0){let n;const i=()=>{n=requestAnimationFrame(()=>{e.apply(t||this,r||[]),n&&i()})};function a(){console.log("Actually stopping and cancelling RAF"),cancelAnimationFrame(n),n=null}return[i,a]}function S(){return[window.innerWidth,window.innerHeight]}function w(e,r={}){let[t,n]=S(),{marginX:i,marginY:a,width:s,height:l}=r;if((typeof i!="number"||i<0)&&(r.marginX=0),(typeof a!="number"||a<0)&&(r.marginY=0),(s==="VIEWPORT"||typeof s!="number"||s<0)&&(s=t-i),(l==="VIEWPORT"||typeof l!="number"||l<0)&&(l=n-a),e.width=s,e.height=l,a){let c=a/2;e.style.marginTop=c+"px",e.style.marginBottom=c+"px"}return[s,l]}const A={TWO_PI:Math.PI*2,PI:Math.PI};let C=0;const E=new Map;function b(e,r={},t){if(typeof e!="function")throw new Error("Scene is missing");let n=`simple_scene_${t||++C}`,i=E.get(n);if(i)return console.warn(`Another scene with id "${t}" already exists. Please provide a different scene ID`),i;let a=_(r);const{canvas:s,wrapper:l,toggleAnimateCheckbox:c}=v({id:n,rootNode:a.root,toggle:a.toggle,toggleChecked:a.startAnimating}),h=s.getContext("2d");let f=[],u=e(A);if(!u||!u.setup&&!u.draw)throw new Error("Please provide a scene - (setup, draw)");function y(){o.stopAnimating(),f.forEach(p=>p()),f=[],c?.remove(),s.remove(),l.remove(),o.startAnimating=g,o.stopAnimating=g,o.setup=g,o.cleanup=g,E.delete(n)}E.set(n,y);let o={canvas:s,ctx:h,startAnimating:g,stopAnimating:g,setup:g,cleanup:y,CVS_WIDTH:0,CVS_HEIGHT:0,CVS_CENTER_X:0,CVS_CENTER_Y:0};if(f.push(m(window,"resize",()=>{[o.CVS_WIDTH,o.CVS_HEIGHT]=w(s,a?.canvas),o.CVS_CENTER_X=o.CVS_WIDTH/2,o.CVS_CENTER_Y=o.CVS_HEIGHT/2,a?.resetOnResize!==!1&&o.setup&&o.setup()})),typeof u.draw=="function"){let[p,T]=I(u.draw.bind(o));a.startAnimating&&p(),o.startAnimating=()=>{T(),p(),c&&!c.checked&&(c.checked=!0)},o.stopAnimating=()=>{T(),c&&c.checked&&(c.checked=!1)},c&&f.push(m(c,"change",()=>{const{checked:V}=c;V?p():T()},{runImmediately:!1}))}return typeof u.setup=="function"&&(u.setup.call(o),o.setup=u.setup.bind(o)),y}function g(){}function _(e){if(e.root instanceof HTMLElement||(e.root=document.body),e.resetOnResize==null&&(e.resetOnResize=!0),e.toggle==null&&(e.toggle=!0),e.startAnimating==null&&(e.startAnimating=!0),e.canvas){let{height:r="VIEWPORT",width:t="VIEWPORT",marginX:n=0,marginY:i=0}=e.canvas;typeof r=="string"&&r!=="VIEWPORT"?r="VIEWPORT":typeof r=="number"&&r<0&&(r=0),typeof t=="string"&&t!=="VIEWPORT"?t="VIEWPORT":typeof t=="number"&&t<0&&(t=0),(typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i<0)&&(i=0),e.canvas.width=t,e.canvas.height=r,e.canvas.marginX=n,e.canvas.marginY=i}return e.canvas||(e.canvas={width:"VIEWPORT",height:"VIEWPORT",marginX:0,marginY:0}),e}function v({id:e,toggle:r,toggleChecked:t,rootNode:n}){const i=document.createElement("div");i.setAttribute("data-scene-id",e),i.style.position="relative";const a=document.createElement("canvas");a.style.display="block",a.style.margin="0 auto",i.appendChild(a);let s;if(r){let l=s=document.createElement("input");const c=[["type","checkbox"],["class","toggle-animate"],["checked",t]];console.log({toggleChecked:t}),c.forEach(([h,f])=>{f==null||f===!1?l.removeAttribute(h):l.setAttribute(h,f.toString())}),i.appendChild(l)}return n.appendChild(i),{wrapper:i,canvas:a,toggleAnimateCheckbox:s}}d.createScene=b,Object.defineProperty(d,"__esModule",{value:!0}),d[Symbol.toStringTag]="Module"});
