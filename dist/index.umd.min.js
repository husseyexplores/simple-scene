(function(l,p){typeof exports=="object"&&typeof module!="undefined"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(l=typeof globalThis!="undefined"?globalThis:l||self,p(l.SimpleScene={}))})(this,function(l){"use strict";function p(e,c,o,t={}){console.log("Adding listener",{element:e,eventName:c,handler:o});const i=t.listener||void 0;return e.addEventListener(c,o,i),typeof t.runImmediately!="boolean"&&(t.runImmediately=!0),t.runImmediately&&o(),function(){console.log("Removing listener",{element:e,eventName:c,handler:o}),e.removeEventListener(c,o)}}function y(e,c=void 0,o=void 0){let t;const i=()=>{t=requestAnimationFrame(()=>{e.apply(o||this,c||[]),t&&i()})};function a(){console.log("Actually stopping and cancelling RAF"),cancelAnimationFrame(t),t=null}return[i,a]}function S(){return[window.innerWidth,window.innerHeight]}function v(e,c={}){let[o,t]=S(),{marginX:i,marginY:a,width:s,height:r}=c;if((typeof i!="number"||i<0)&&(c.marginX=0),(typeof a!="number"||a<0)&&(c.marginY=0),(s==="VIEWPORT"||typeof s!="number"||s<0)&&(s=o-i),(r==="VIEWPORT"||typeof r!="number"||r<0)&&(r=t-a),e.width=s,e.height=r,a){let d=a/2;e.style.marginTop=d+"px",e.style.marginBottom=d+"px"}return[s,r]}const T={TWO_PI:Math.PI*2,PI:Math.PI},m=new Map;function C(e,c,o={}){if(typeof c!="function")throw new Error("Scene is missing");let t=m.get(e);if(t)return console.warn(`Another scene with id "${e}" already exists. Please provide a different scene ID`),t;let i=I(o);const{canvas:a,wrapper:s,toggleAnimateCheckbox:r}=_({id:e,rootNode:i.root,toggle:i.toggle}),d=a.getContext("2d");let g=[],u=c(T);if(!u||!u.setup&&!u.draw)throw new Error("Please provide a scene - (setup, draw)");function E(){n.stop(),g.forEach(h=>h()),g=[],r?.remove(),a.remove(),s.remove(),n.start=f,n.stop=f,n.setup=f,n.cleanup=f,m.delete(e)}m.set(e,E);let n={canvas:a,ctx:d,start:f,stop:f,setup:f,cleanup:E,CVS_WIDTH:0,CVS_HEIGHT:0,CVS_CENTER_X:0,CVS_CENTER_Y:0};if(g.push(p(window,"resize",()=>{[n.CVS_WIDTH,n.CVS_HEIGHT]=v(a,i?.canvas),n.CVS_CENTER_X=n.CVS_WIDTH/2,n.CVS_CENTER_Y=n.CVS_HEIGHT/2,i?.resetOnResize!==!1&&n.setup&&n.setup()})),typeof u.setup=="function"&&(u.setup.call(n),n.setup=u.setup.bind(n)),typeof u.draw=="function"){let[h,w]=y(u.draw.bind(n));n.start=()=>{h(),r&&!r.checked&&(r.checked=!0)},n.stop=()=>{w(),r&&r.checked&&(r.checked=!1)},r&&g.push(p(r,"change",()=>{const{checked:b}=r;b?h():w()}))}return E}function f(){}function I(e){return e.root||(e.root=document.body),e.resetOnResize==null&&(e.resetOnResize=!0),e.toggle==null&&(e.toggle=!0),e.canvas&&(e.canvas.height||(e.canvas.height="VIEWPORT"),e.canvas.width||(e.canvas.width="VIEWPORT"),e.canvas.marginX||(e.canvas.marginX=0),e.canvas.marginY||(e.canvas.marginX=0)),e.canvas||(e.canvas={width:"VIEWPORT",height:"VIEWPORT",marginX:0,marginY:0}),e}function _({id:e,toggle:c,rootNode:o}){const t=document.createElement("div");t.id=e,t.style.position="relative";const i=document.createElement("canvas");i.style.display="block",i.style.margin="0 auto",t.appendChild(i);let a;if(c){let s=a=document.createElement("input");[["type","checkbox"],["class","toggle-animate"],["checked",!0]].forEach(([d,g])=>{g===null?s.removeAttribute(d):s.setAttribute(d,g.toString())}),t.appendChild(s)}return o.appendChild(t),{wrapper:t,canvas:i,toggleAnimateCheckbox:a}}l.createScene=C,Object.defineProperty(l,"__esModule",{value:!0}),l[Symbol.toStringTag]="Module"});
