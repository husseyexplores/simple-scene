function E(e,c,o,t={}){console.log("Adding listener",{element:e,eventName:c,handler:o});const i=t.listener||void 0;return e.addEventListener(c,o,i),typeof t.runImmediately!="boolean"&&(t.runImmediately=!0),t.runImmediately&&o(),function(){console.log("Removing listener",{element:e,eventName:c,handler:o}),e.removeEventListener(c,o)}}function v(e,c=void 0,o=void 0){let t;const i=()=>{t=requestAnimationFrame(()=>{e.apply(o||this,c||[]),t&&i()})};function a(){console.log("Actually stopping and cancelling RAF"),cancelAnimationFrame(t),t=null}return[i,a]}function C(){return[window.innerWidth,window.innerHeight]}function I(e,c={}){let[o,t]=C(),{marginX:i,marginY:a,width:s,height:r}=c;if((typeof i!="number"||i<0)&&(c.marginX=0),(typeof a!="number"||a<0)&&(c.marginY=0),(s==="VIEWPORT"||typeof s!="number"||s<0)&&(s=o-i),(r==="VIEWPORT"||typeof r!="number"||r<0)&&(r=t-a),e.width=s,e.height=r,a){let u=a/2;e.style.marginTop=u+"px",e.style.marginBottom=u+"px"}return[s,r]}const y={TWO_PI:Math.PI*2,PI:Math.PI},p=new Map;function T(e,c,o={}){if(typeof c!="function")throw new Error("Scene is missing");let t=p.get(e);if(t)return console.warn(`Another scene with id "${e}" already exists. Please provide a different scene ID`),t;let i=S(o);const{canvas:a,wrapper:s,toggleAnimateCheckbox:r}=V({id:e,rootNode:i.root,toggle:i.toggle}),u=a.getContext("2d");let f=[],l=c(y);if(!l||!l.setup&&!l.draw)throw new Error("Please provide a scene - (setup, draw)");function h(){n.stop(),f.forEach(g=>g()),f=[],r?.remove(),a.remove(),s.remove(),n.start=d,n.stop=d,n.setup=d,n.cleanup=d,p.delete(e)}p.set(e,h);let n={canvas:a,ctx:u,start:d,stop:d,setup:d,cleanup:h,CVS_WIDTH:0,CVS_HEIGHT:0,CVS_CENTER_X:0,CVS_CENTER_Y:0};if(f.push(E(window,"resize",()=>{[n.CVS_WIDTH,n.CVS_HEIGHT]=I(a,i?.canvas),n.CVS_CENTER_X=n.CVS_WIDTH/2,n.CVS_CENTER_Y=n.CVS_HEIGHT/2,i?.resetOnResize!==!1&&n.setup&&n.setup()})),typeof l.setup=="function"&&(l.setup.call(n),n.setup=l.setup.bind(n)),typeof l.draw=="function"){let[g,m]=v(l.draw.bind(n));n.start=()=>{g(),r&&!r.checked&&(r.checked=!0)},n.stop=()=>{m(),r&&r.checked&&(r.checked=!1)},r&&f.push(E(r,"change",()=>{const{checked:w}=r;w?g():m()}))}return h}function d(){}function S(e){return e.root||(e.root=document.body),e.resetOnResize==null&&(e.resetOnResize=!0),e.toggle==null&&(e.toggle=!0),e.canvas&&(e.canvas.height||(e.canvas.height="VIEWPORT"),e.canvas.width||(e.canvas.width="VIEWPORT"),e.canvas.marginX||(e.canvas.marginX=0),e.canvas.marginY||(e.canvas.marginX=0)),e.canvas||(e.canvas={width:"VIEWPORT",height:"VIEWPORT",marginX:0,marginY:0}),e}function V({id:e,toggle:c,rootNode:o}){const t=document.createElement("div");t.id=e,t.style.position="relative";const i=document.createElement("canvas");i.style.display="block",i.style.margin="0 auto",t.appendChild(i);let a;if(c){let s=a=document.createElement("input");[["type","checkbox"],["class","toggle-animate"],["checked",!0]].forEach(([u,f])=>{f===null?s.removeAttribute(u):s.setAttribute(u,f.toString())}),t.appendChild(s)}return o.appendChild(t),{wrapper:t,canvas:i,toggleAnimateCheckbox:a}}export{T as createScene};
