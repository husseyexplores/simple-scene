function y(e,r,t,n={}){console.log("Adding listener",{element:e,eventName:r,handler:t});const i=n.listener||void 0;return e.addEventListener(r,t,i),typeof n.runImmediately!="boolean"&&(n.runImmediately=!0),n.runImmediately&&t(),function(){console.log("Removing listener",{element:e,eventName:r,handler:t}),e.removeEventListener(r,t)}}function T(e,r=void 0,t=void 0){let n;const i=()=>{n=requestAnimationFrame(()=>{e.apply(t||this,r||[]),n&&i()})};function a(){console.log("Actually stopping and cancelling RAF"),cancelAnimationFrame(n),n=null}return[i,a]}function w(){return[window.innerWidth,window.innerHeight]}function A(e,r={}){let[t,n]=w(),{marginX:i,marginY:a,width:s,height:l}=r;if((typeof i!="number"||i<0)&&(r.marginX=0),(typeof a!="number"||a<0)&&(r.marginY=0),(s==="VIEWPORT"||typeof s!="number"||s<0)&&(s=t-i),(l==="VIEWPORT"||typeof l!="number"||l<0)&&(l=n-a),e.width=s,e.height=l,a){let o=a/2;e.style.marginTop=o+"px",e.style.marginBottom=o+"px"}return[s,l]}const C={TWO_PI:Math.PI*2,PI:Math.PI};let S=0;const E=new Map;function V(e,r={},t){if(typeof e!="function")throw new Error("Scene is missing");let n=`simple_scene_${t||++S}`,i=E.get(n);if(i)return console.warn(`Another scene with id "${t}" already exists. Please provide a different scene ID`),i;let a=b(r);const{canvas:s,wrapper:l,toggleAnimateCheckbox:o}=v({id:n,rootNode:a.root,toggle:a.toggle,toggleChecked:a.startAnimating}),d=s.getContext("2d");let u=[],f=e(C);if(!f||!f.setup&&!f.draw)throw new Error("Please provide a scene - (setup, draw)");function p(){c.stopAnimating(),u.forEach(m=>m()),u=[],o?.remove(),s.remove(),l.remove(),c.startAnimating=g,c.stopAnimating=g,c.setup=g,c.cleanup=g,E.delete(n)}E.set(n,p);let c={canvas:s,ctx:d,startAnimating:g,stopAnimating:g,setup:g,cleanup:p,CVS_WIDTH:0,CVS_HEIGHT:0,CVS_CENTER_X:0,CVS_CENTER_Y:0};if(u.push(y(window,"resize",()=>{[c.CVS_WIDTH,c.CVS_HEIGHT]=A(s,a?.canvas),c.CVS_CENTER_X=c.CVS_WIDTH/2,c.CVS_CENTER_Y=c.CVS_HEIGHT/2,a?.resetOnResize!==!1&&c.setup&&c.setup()})),typeof f.draw=="function"){let[m,h]=T(f.draw.bind(c));a.startAnimating&&m(),c.startAnimating=()=>{h(),m(),o&&!o.checked&&(o.checked=!0)},c.stopAnimating=()=>{h(),o&&o.checked&&(o.checked=!1)},o&&u.push(y(o,"change",()=>{const{checked:I}=o;I?m():h()},{runImmediately:!1}))}return typeof f.setup=="function"&&(f.setup.call(c),c.setup=f.setup.bind(c)),p}function g(){}function b(e){if(e.root instanceof HTMLElement||(e.root=document.body),e.resetOnResize==null&&(e.resetOnResize=!0),e.toggle==null&&(e.toggle=!0),e.startAnimating==null&&(e.startAnimating=!0),e.canvas){let{height:r="VIEWPORT",width:t="VIEWPORT",marginX:n=0,marginY:i=0}=e.canvas;typeof r=="string"&&r!=="VIEWPORT"?r="VIEWPORT":typeof r=="number"&&r<0&&(r=0),typeof t=="string"&&t!=="VIEWPORT"?t="VIEWPORT":typeof t=="number"&&t<0&&(t=0),(typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i<0)&&(i=0),e.canvas.width=t,e.canvas.height=r,e.canvas.marginX=n,e.canvas.marginY=i}return e.canvas||(e.canvas={width:"VIEWPORT",height:"VIEWPORT",marginX:0,marginY:0}),e}function v({id:e,toggle:r,toggleChecked:t,rootNode:n}){const i=document.createElement("div");i.setAttribute("data-scene-id",e),i.style.position="relative";const a=document.createElement("canvas");a.style.display="block",a.style.margin="0 auto",i.appendChild(a);let s;if(r){let l=s=document.createElement("input");const o=[["type","checkbox"],["class","toggle-animate"],["checked",t]];console.log({toggleChecked:t}),o.forEach(([d,u])=>{u==null||u===!1?l.removeAttribute(d):l.setAttribute(d,u.toString())}),i.appendChild(l)}return n.appendChild(i),{wrapper:i,canvas:a,toggleAnimateCheckbox:s}}export{V as createScene};
